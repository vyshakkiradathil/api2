(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5563],{30493:function(P,m,e){"use strict";e.d(m,{Z:function(){return M}});var t=e(32735),u=e(82055),r=e(87933),o=e(41415),a=e(69262),i=e(66456),d=e(29439),v=e(60216),s=e.n(v),T=e(67879),n=e(44647),x=e(94735);const g=({onRegenerate:h,idToRegenerate:k,backUrl:N,onError:S})=>{const{formatMessage:I}=(0,T.Z)(),[R,L]=(0,t.useState)(!1),{regenerateData:B,isLoadingConfirmation:F}=(0,x.rW)(N,k,h,S),W=async()=>{B(),L(!1)};return t.createElement(t.Fragment,null,t.createElement(o.z,{startIcon:t.createElement(n.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>L(!0),name:"regenerate"},I({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(a.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(n.Z,null),isConfirmButtonLoading:F,isOpen:R,onToggleDialog:()=>L(!1),onConfirm:W,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};g.defaultProps={onRegenerate(){},onError:void 0},g.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};var l=g;const c=({title:h,token:k,setToken:N,canEditInputs:S,canRegenerate:I,isSubmitting:R,backUrl:L,regenerateUrl:B,onErrorRegenerate:F})=>{const{formatMessage:W}=(0,T.Z)(),Y=H=>{N({...k,accessKey:H})};return t.createElement(u.T,{title:k?.name||W(h),primaryAction:S?t.createElement(r.k,{gap:2},I&&k?.id&&t.createElement(l,{backUrl:B,onRegenerate:Y,idToRegenerate:k?.id,onError:F}),t.createElement(o.z,{disabled:R,loading:R,startIcon:t.createElement(i.Z,null),type:"submit",size:"S"},W({id:"global.save",defaultMessage:"Save"}))):I&&k?.id&&t.createElement(l,{onRegenerate:Y,idToRegenerate:k?.id,backUrl:B}),navigationAction:t.createElement(a.rU,{startIcon:t.createElement(d.Z,null),to:L},W({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};c.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},c.defaultProps={token:void 0,onErrorRegenerate:void 0};var M=c},4321:function(P,m,e){"use strict";var t=e(32735),u=e(68465),r=e(84967),o=e(49372),a=e(60216),i=e.n(a),d=e(67879),v=e(37944);const s=({token:T,errors:n,values:x,onChange:g,isCreating:l})=>{const{formatMessage:c}=(0,d.Z)();return t.createElement(t.Fragment,null,t.createElement(u.P,{name:"lifespan",label:c({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:x.lifespan!==null?x.lifespan:"0",error:n.lifespan?c(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:M=>{g({target:{name:"lifespan",value:M}})},required:!0,disabled:!l,placeholder:"Select"},t.createElement(r.W,{value:"604800000"},c({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(r.W,{value:"2592000000"},c({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(r.W,{value:"7776000000"},c({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(r.W,{value:"0"},c({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!l&&`${c({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,v.IX)(T?.createdAt,parseInt(x.lifespan,10))}`))};s.propTypes={errors:i().shape({lifespan:i().string}),onChange:i().func.isRequired,values:i().shape({lifespan:i().oneOfType([i().number,i().string])}).isRequired,isCreating:i().bool.isRequired,token:i().shape({id:i().oneOfType([i().number,i().string]),type:i().string,lifespan:i().string,name:i().string,accessKey:i().string,permissions:i().array,description:i().string,createdAt:i().string})},s.defaultProps={errors:{},token:{}},m.Z=s},93682:function(P,m,e){"use strict";var t=e(32735),u=e(50563),r=e(69262),o=e(47765),a=e(11631),i=e(60216),d=e.n(i),v=e(67879);const s=({token:T,tokenType:n})=>{const{formatMessage:x}=(0,v.Z)(),g=(0,r.lm)(),{trackUsage:l}=(0,r.rS)(),{copy:c}=(0,r.VP)(),M=h=>async()=>{await c(h)&&(l.current("didCopyTokenKey",{tokenType:n}),g({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(r.Y_,{endAction:T&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(u.h,{label:x({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:M(T),noBorder:!0,icon:t.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:T||x({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:x(T?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:d().string,tokenType:d().string.isRequired},m.Z=s},42789:function(P,m,e){"use strict";var t=e(32735),u=e(33475),r=e(60216),o=e.n(r),a=e(67879);const i=({errors:d,values:v,onChange:s,canEditInputs:T})=>{const{formatMessage:n}=(0,a.Z)();return t.createElement(u.g,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:d.description?n(d.description?.id?d.description:{id:d.description,defaultMessage:d.description}):null,onChange:s,disabled:!T},v.description)};i.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},i.defaultProps={errors:{}},m.Z=i},8377:function(P,m,e){"use strict";var t=e(32735),u=e(10369),r=e(60216),o=e.n(r),a=e(67879);const i=({errors:d,values:v,onChange:s,canEditInputs:T})=>{const{formatMessage:n}=(0,a.Z)();return t.createElement(u.o,{name:"name",error:d.name?n(d.name?.id?d.name:{id:d.name,defaultMessage:d.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:s,value:v.name,disabled:!T,required:!0})};i.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},i.defaultProps={errors:{}},m.Z=i},49638:function(P,m,e){"use strict";var t=e(32735),u=e(68465),r=e(84967),o=e(60216),a=e.n(o),i=e(67879);const d=({name:v,errors:s,values:T,onChange:n,canEditInputs:x,options:g,label:l})=>{const{formatMessage:c}=(0,i.Z)();return t.createElement(u.P,{name:v,label:c({id:l.id,defaultMessage:l.defaultMessage}),value:T&&T[v],error:s[v]?c(s[v]?.id?s[v]:{id:s[v],defaultMessage:s[v]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!x},g&&g.map(({value:M,label:h})=>t.createElement(r.W,{key:M,value:M},c(h))))};d.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},d.defaultProps={name:"type",errors:{},options:[]},m.Z=d},68774:function(P,m,e){"use strict";e.d(m,{Z:function(){return t},f:function(){return u}});const t="api-token",u="transfer-token"},35563:function(P,m,e){"use strict";e.d(m,{Z:function(){return He}});var t=e(32735),u=e(27649),r=e(17e3),o=e(87933),a=e(69262),i=e(92802),d=e(67879),v=e(20108),s=e(53038),T=e(60216),n=e.n(T);const x=(0,t.createContext)({}),g=({children:p,...E})=>t.createElement(x.Provider,{value:E},p),l=()=>(0,t.useContext)(x);g.propTypes={children:n().node.isRequired};var c=e(83983),M=e(8997),h=e(68774),k=e(30493),N=e(93682),S=e(72850),I=e(49372),R=e(15335),L=e(5803),B=e(4321),F=e(42789),W=e(8377),Y=e(49638);const H=({errors:p,onChange:E,canEditInputs:f,isCreating:D,values:A,apiToken:y,onDispatch:$,setHasChangedPermissions:V})=>{const{formatMessage:K}=(0,d.Z)(),z=({target:{value:j}})=>{V(!1),j==="full-access"&&$({type:"SELECT_ALL_ACTIONS"}),j==="read-only"&&$({type:"ON_CHANGE_READ_ONLY"})},_=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(I.Z,{variant:"delta",as:"h2"},K({id:"global.details",defaultMessage:"Details"})),t.createElement(R.r,{gap:5},t.createElement(L.P,{key:"name",col:6,xs:12},t.createElement(W.Z,{errors:p,values:A,canEditInputs:f,onChange:E})),t.createElement(L.P,{key:"description",col:6,xs:12},t.createElement(F.Z,{errors:p,values:A,canEditInputs:f,onChange:E})),t.createElement(L.P,{key:"lifespan",col:6,xs:12},t.createElement(B.Z,{isCreating:D,errors:p,values:A,onChange:E,token:y})),t.createElement(L.P,{key:"type",col:6,xs:12},t.createElement(Y.Z,{values:A,errors:p,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:j=>{z({target:{value:j}}),E({target:{name:"type",value:j}})},options:_,canEditInputs:f})))))};H.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},H.defaultProps={errors:{},apiToken:{}};var ie=H,Q=e(82055),ee=e(41415),le=e(66456);const J=({apiTokenName:p})=>{const{formatMessage:E}=(0,d.Z)();return(0,a.go)(),t.createElement(u.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"API Tokens"}),t.createElement(Q.T,{primaryAction:t.createElement(ee.z,{disabled:!0,startIcon:t.createElement(le.Z,null),type:"button",size:"L"},E({id:"global.save",defaultMessage:"Save"})),title:p||E({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(r.D,null,t.createElement(a.dO,null)))};J.defaultProps={apiTokenName:null},J.propTypes={apiTokenName:n().string};var de=J,ce=e(37213),te=e.n(ce),ne=e(15738),se=e.n(ne),ae=e(8471),Pe=p=>{switch(p){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}};const Me=(0,ae.ZP)(S.x)`
  margin: -1px;
  border-radius: ${({theme:p})=>p.spaces[1]} 0 0 ${({theme:p})=>p.spaces[1]};
`;function pe({route:p}){const{formatMessage:E}=(0,d.Z)(),{method:f,handler:D,path:A}=p,y=A?se()(A.split("/")):[],[$="",V=""]=D?D.split("."):[],K=Pe(p.method);return t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},E({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,$),t.createElement(I.Z,{variant:"delta",textColor:"primary600"},".",V)),t.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(Me,{background:K.background,borderColor:K.border,padding:2},t.createElement(I.Z,{fontWeight:"bold",textColor:K.text},f)),t.createElement(S.x,{paddingLeft:2,paddingRight:2},te()(y,z=>t.createElement(I.Z,{key:z,textColor:z.includes(":")?"neutral600":"neutral900"},"/",z)))))}pe.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},pe.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};var Ae=pe,xe=()=>{const{value:{selectedAction:p,routes:E}}=l(),{formatMessage:f}=(0,d.Z)(),D=p?.split(".")[0];return t.createElement(L.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},p?t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},E[D]?.map(A=>A.config.auth?.scope?.includes(p)||A.handler===p?t.createElement(Ae,{key:A.handler,route:A}):null)):t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},f({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Oe=e(83828),Re=e(61762),Ie=e(89966),ve=e(8284),De=e(45112),ke=e(73400),Se=e.n(ke);const Te=ae.iv`
  background: ${p=>p.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`;var Le=(0,ae.ZP)(S.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${p=>p.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${p=>p.isActive&&Te}
  &:hover {
    ${Te}
  }
`;const Be=ae.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:p})=>p.colors.neutral150};
`,ue=({controllers:p,label:E,orderNumber:f,disabled:D,onExpanded:A,indexExpandendCollapsedContent:y})=>{const{value:{onChangeSelectAll:$,onChange:V,selectedActions:K,setSelectedAction:z,selectedAction:_}}=l(),[j,oe]=(0,t.useState)(!1),{formatMessage:w}=(0,d.Z)(),U=()=>{oe(Z=>!Z),A(f)};(0,t.useEffect)(()=>{y!==null&&y!==f&&j&&oe(!1)},[y,f,j]);const X=Z=>Z===_;return t.createElement(Oe.U,{expanded:j,onToggle:U,variant:f%2?"primary":"secondary"},t.createElement(Re.B,{title:Se()(E)}),t.createElement(Ie.v,null,p?.map(Z=>{const re=Z.actions.every(O=>K.includes(O.actionId)),Ee=Z.actions.some(O=>K.includes(O.actionId));return t.createElement(S.x,{key:`${E}.${Z?.controller}`},t.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(S.x,{paddingRight:4},t.createElement(I.Z,{variant:"sigma",textColor:"neutral600"},Z?.controller)),t.createElement(Be,null),t.createElement(S.x,{paddingLeft:4},t.createElement(ve.X,{value:re,indeterminate:!re&&Ee,onValueChange:()=>{$({target:{value:[...Z.actions]}})},disabled:D},w({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(R.r,{gap:4,padding:4},Z?.actions&&Z?.actions.map(O=>t.createElement(L.P,{col:6,key:O.actionId},t.createElement(Le,{isActive:X(O.actionId),padding:2,hasRadius:!0},t.createElement(ve.X,{value:K.includes(O.actionId),name:O.actionId,onValueChange:()=>{V({target:{value:O.actionId}})},disabled:D},O.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>z({target:{value:O.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(De.Z,null)))))))})))};ue.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ue.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};var be=ue;const ge=({section:p,...E})=>{const[f,D]=(0,t.useState)(null),A=y=>D(y);return t.createElement(S.x,{padding:4,background:"neutral0"},p&&p.map((y,$)=>t.createElement(be,{key:y.apiId,label:y.label,controllers:y.controllers,orderNumber:$,indexExpandendCollapsedContent:f,onExpanded:A,name:y.apiId,...E})))};ge.defaultProps={section:null},ge.propTypes={section:n().arrayOf(n().object)};var Ue=ge;const Ze=({...p})=>{const{value:{data:E}}=l(),{formatMessage:f}=(0,d.Z)();return t.createElement(R.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(L.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h2"},f({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),E?.permissions&&t.createElement(Ue,{section:E?.permissions,...p})),t.createElement(xe,null))};var We=(0,t.memo)(Ze),me=e(37944),Ke=(p,E=[])=>({...p,selectedAction:null,routes:[],selectedActions:[],data:(0,me.mk)(E)}),Ne=e(97889),$e=e(82879),Ce=e.n($e);const je={data:{},selectedActions:[]};var Fe=(p,E)=>(0,Ne.ZP)(p,f=>{switch(E.type){case"ON_CHANGE":{f.selectedActions.includes(E.value)?Ce()(f.selectedActions,E.value):f.selectedActions.push(E.value);break}case"SELECT_ALL_IN_PERMISSION":{E.value.every(A=>f.selectedActions.includes(A.actionId))?E.value.forEach(A=>{Ce()(f.selectedActions,A.actionId)}):E.value.forEach(A=>{f.selectedActions.push(A.actionId)});break}case"SELECT_ALL_ACTIONS":{f.selectedActions=[...f.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const D=f.data.allActionsIds.filter(A=>A.includes("find")||A.includes("findOne"));f.selectedActions=[...D];break}case"UPDATE_PERMISSIONS_LAYOUT":{f.data=(0,me.mk)(E.value);break}case"UPDATE_ROUTES":{f.routes={...E.value};break}case"UPDATE_PERMISSIONS":{f.selectedActions=[...E.value];break}case"SET_SELECTED_ACTION":{f.selectedAction=E.value;break}default:return f}});const ze="Name already taken";var He=()=>{(0,a.go)();const{formatMessage:p}=(0,d.Z)(),{lockApp:E,unlockApp:f}=(0,a.o1)(),D=(0,a.lm)(),A=(0,s.k6)(),[y,$]=(0,t.useState)(A.location.state?.apiToken.accessKey?{...A.location.state.apiToken}:null),{trackUsage:V}=(0,a.rS)(),K=(0,t.useRef)(V),{setCurrentStep:z}=(0,a.c1)(),{allowedActions:{canCreate:_,canUpdate:j,canRegenerate:oe}}=(0,a.ss)(c.Z.settings["api-tokens"]),[w,U]=(0,t.useReducer)(Fe,je,C=>Ke(C,{})),{params:{id:X}}=(0,s.$B)("/settings/api-tokens/:id"),{get:Z,post:re,put:Ee}=(0,a.kY)(),O=X==="create";(0,v.useQuery)("content-api-permissions",async()=>{const[C,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:b}=await Z(q);return b.data}));U({type:"UPDATE_PERMISSIONS_LAYOUT",value:C}),U({type:"UPDATE_ROUTES",value:G}),y&&(y?.type==="read-only"&&U({type:"ON_CHANGE_READ_ONLY"}),y?.type==="full-access"&&U({type:"SELECT_ALL_ACTIONS"}),y?.type==="custom"&&U({type:"UPDATE_PERMISSIONS",value:y?.permissions}))},{onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{K.current(O?"didAddTokenFromList":"didEditTokenFromList",{tokenType:h.Z})},[O]);const{status:Ve}=(0,v.useQuery)(["api-token",X],async()=>{const{data:{data:C}}=await Z(`/admin/api-tokens/${X}`);return $({...C}),C?.type==="read-only"&&U({type:"ON_CHANGE_READ_ONLY"}),C?.type==="full-access"&&U({type:"SELECT_ALL_ACTIONS"}),C?.type==="custom"&&U({type:"UPDATE_PERMISSIONS",value:C?.permissions}),C},{enabled:!O&&!y,onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ge=async(C,G)=>{K.current(O?"willCreateToken":"willEditToken",{tokenType:h.Z}),E();const q=C.lifespan&&parseInt(C.lifespan,10)&&C.lifespan!=="0"?parseInt(C.lifespan,10):null;try{const{data:{data:b}}=O?await re("/admin/api-tokens",{...C,lifespan:q,permissions:C.type==="custom"?w.selectedActions:null}):await Ee(`/admin/api-tokens/${X}`,{name:C.name,description:C.description,type:C.type,permissions:C.type==="custom"?w.selectedActions:null});O&&(A.replace(`/settings/api-tokens/${b.id}`,{apiToken:b}),z("apiTokens.success")),f(),$({...b}),D({type:"success",message:p(O?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),K.current(O?"didCreateToken":"didEditToken",{type:y.type,tokenType:h.Z})}catch(b){const he=(0,M.Iz)(b.response.data);G.setErrors(he),b?.response?.data?.error?.message===ze?D({type:"warning",message:b.response.data.message||"notification.error.tokennamenotunique"}):D({type:"warning",message:b?.response?.data?.message||"notification.error"}),f()}},[Ye,fe]=(0,t.useState)(!1),Qe={...w,onChange:({target:{value:C}})=>{fe(!0),U({type:"ON_CHANGE",value:C})},onChangeSelectAll:({target:{value:C}})=>{fe(!0),U({type:"SELECT_ALL_IN_PERMISSION",value:C})},setSelectedAction:({target:{value:C}})=>{U({type:"SET_SELECTED_ACTION",value:C})}},ye=j&&!O||_&&O;return!O&&!y&&Ve!=="success"?t.createElement(de,{apiTokenName:y?.name}):t.createElement(g,{value:Qe},t.createElement(u.o,null,t.createElement(a.SL,{name:"API Tokens"}),t.createElement(i.J9,{validationSchema:me.fK,validateOnChange:!1,initialValues:{name:y?.name||"",description:y?.description||"",type:y?.type,lifespan:y?.lifespan?y.lifespan.toString():y?.lifespan},enableReinitialize:!0,onSubmit:(C,G)=>Ge(C,G)},({errors:C,handleChange:G,isSubmitting:q,values:b,setFieldValue:he})=>(Ye&&b?.type!=="custom"&&he("type","custom"),t.createElement(a.l0,null,t.createElement(k.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:y,setToken:$,canEditInputs:ye,canRegenerate:oe,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),t.createElement(r.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(y?.name)&&t.createElement(N.Z,{token:y?.accessKey,tokenType:h.Z}),t.createElement(ie,{errors:C,onChange:G,canEditInputs:ye,isCreating:O,values:b,apiToken:y,onDispatch:U,setHasChangedPermissions:fe}),t.createElement(We,{disabled:!ye||b?.type==="read-only"||b?.type==="full-access"}))))))))}},37944:function(P,m,e){"use strict";e.d(m,{IX:function(){return a},fK:function(){return s},mk:function(){return n}});var t=e(14723),u=e(85544),r=e(76698),a=(x,g,l="en")=>{if(g&&typeof g=="number"){const c=g/24/60/60/1e3;return(0,t.Z)((0,u.Z)(new Date(x),c),"PPP",{locale:r[l]})}return"Unlimited"},i=e(69262),d=e(24346),s=d.Ry().shape({name:d.Z_(i.I0.string).max(100).required(i.I0.required),type:d.Z_(i.I0.string).oneOf(["read-only","full-access","custom"]).required(i.I0.required),description:d.Z_().nullable(),lifespan:d.Rx().integer().min(0).nullable().defined(i.I0.required)}),n=x=>{const g={allActionsIds:[],permissions:[]};return g.permissions=Object.keys(x).map(l=>({apiId:l,label:l.split("::")[1],controllers:Object.keys(x[l].controllers).map(c=>({controller:c,actions:x[l].controllers[c].map(M=>{const h=`${l}.${c}.${M}`;return l.includes("api::")&&g.allActionsIds.push(h),{action:M,actionId:h}}).flat()})).flat()})),g}},60528:function(P){function m(e,t,u,r){for(var o=e.length,a=u+(r?1:-1);r?a--:++a<o;)if(t(e[a],a,e))return a;return-1}P.exports=m},87650:function(P,m,e){var t=e(60528),u=e(25556),r=e(54256);function o(a,i,d){return i===i?r(a,i,d):t(a,u,d)}P.exports=o},15880:function(P){function m(e,t,u,r){for(var o=u-1,a=e.length;++o<a;)if(r(e[o],t))return o;return-1}P.exports=m},25556:function(P){function m(e){return e!==e}P.exports=m},11224:function(P,m,e){var t=e(26460),u=e(87650),r=e(15880),o=e(76535),a=e(66438),i=Array.prototype,d=i.splice;function v(s,T,n,x){var g=x?r:u,l=-1,c=T.length,M=s;for(s===T&&(T=a(T)),n&&(M=t(s,o(n)));++l<c;)for(var h=0,k=T[l],N=n?n(k):k;(h=g(M,N,h,x))>-1;)M!==s&&d.call(M,h,1),d.call(s,h,1);return s}P.exports=v},54256:function(P){function m(e,t,u){for(var r=u-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}P.exports=m},82879:function(P,m,e){var t=e(94569),u=e(83147),r=t(u);P.exports=r},83147:function(P,m,e){var t=e(11224);function u(r,o){return r&&r.length&&o&&o.length?t(r,o):r}P.exports=u},15738:function(P,m,e){var t=e(4293);function u(r){var o=r==null?0:r.length;return o?t(r,1,o):[]}P.exports=u},83828:function(P,m,e){"use strict";e.d(m,{U:function(){return x},y:function(){return T}});var t=e(74512),u=e(32735),r=e(8471),o=e(91045),a=e(74971),i=e(49372),d=e(87933),v=e(72850);const s=({theme:g,expanded:l,variant:c,disabled:M,error:h})=>h?`1px solid ${g.colors.danger600} !important`:M?`1px solid ${g.colors.neutral150}`:l?`1px solid ${g.colors.primary600}`:c==="primary"?`1px solid ${g.colors.neutral0}`:`1px solid ${g.colors.neutral100}`,T=(0,r.ZP)(i.Z)``,n=(0,r.ZP)(v.x)`
  border: ${s};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:g})=>g.colors.primary600};

    ${T} {
      color: ${({theme:g,expanded:l})=>l?void 0:g.colors.primary700};
    }

    ${i.Z} {
      color: ${({theme:g,expanded:l})=>l?void 0:g.colors.primary600};
    }

    & > ${d.k} {
      background: ${({theme:g})=>g.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:g})=>g.colors.primary200};
    }
  }
`,x=({children:g,disabled:l=!1,error:c,expanded:M=!1,hasErrorMessage:h=!0,id:k,onToggle:N,toggle:S,size:I="M",variant:R="primary",shadow:L})=>{const B=(0,a.M)(k),F=u.useMemo(()=>({expanded:M,onToggle:N,toggle:S,id:B,size:I,variant:R,disabled:l}),[l,M,B,N,I,S,R]);return(0,t.jsxs)(o.S.Provider,{value:F,children:[(0,t.jsx)(n,{"data-strapi-expanded":M,disabled:l,"aria-disabled":l,expanded:M,hasRadius:!0,variant:R,error:c,shadow:L,children:g}),c&&h&&(0,t.jsx)(v.x,{paddingTop:1,children:(0,t.jsx)(i.Z,{variant:"pi",textColor:"danger600",children:c})})]})}},89966:function(P,m,e){"use strict";e.d(m,{v:function(){return o}});var t=e(74512),u=e(91045),r=e(72850);const o=({children:a,...i})=>{const{expanded:d,id:v}=(0,u.A)();if(!d)return null;const s=`accordion-content-${v}`,T=`accordion-label-${v}`,n=`accordion-desc-${v}`;return(0,t.jsx)(r.x,{role:"region",id:s,"aria-labelledby":T,"aria-describedby":n,...i,children:a})}},91045:function(P,m,e){"use strict";e.d(m,{A:function(){return r},S:function(){return u}});var t=e(32735);const u=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),r=()=>(0,t.useContext)(u)},61762:function(P,m,e){"use strict";e.d(m,{B:function(){return g}});var t=e(74512),u=e(16899),r=e(8471),o=e(83828),a=e(91045);const i=({expanded:l,disabled:c,variant:M})=>{let h="neutral100";return l?h="primary100":c?h="neutral150":M==="primary"&&(h="neutral0"),h};var d=e(7563),v=e(99140),s=e(87933),T=e(49372);const n=(0,r.ZP)(d.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:l,expanded:c})=>c?l.colors.primary600:l.colors.neutral500};
    }
  }
`,x=(0,r.ZP)(s.k)`
  min-height: ${({theme:l,size:c})=>l.sizes.accordions[c]};
  border-radius: ${({theme:l,expanded:c})=>c?`${l.borderRadius} ${l.borderRadius} 0 0`:l.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:l})=>l.colors.primary600};
      }
    }
  }
`,g=({title:l,description:c,as:M="span",togglePosition:h="right",action:k,...N})=>{const{onToggle:S,toggle:I,expanded:R,id:L,size:B,variant:F,disabled:W}=(0,a.A)(),Y=`accordion-content-${L}`,H=`accordion-label-${L}`,ie=`accordion-desc-${L}`,Q=B==="M"?6:4,ee=B==="M"?Q:Q-2,le=i({expanded:R,disabled:W,variant:F}),J={as:M,fontWeight:B==="S"?"bold":void 0,id:H,textColor:R?"primary600":"neutral700",ellipsis:!0,variant:B==="M"?"delta":void 0},de=R?"primary600":"neutral600",ce=R?"primary200":"neutral200",te=B==="M"?`${32/16}rem`:`${24/16}rem`,ne=()=>{W||(I&&!S?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),I()):S&&S())},se=(0,t.jsx)(s.k,{justifyContent:"center",borderRadius:"50%",height:te,width:te,transform:R?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:W?"not-allowed":"pointer",onClick:ne,shrink:0,children:(0,t.jsx)(v.J,{as:u.Z,width:B==="M"?`${11/16}rem`:`${8/16}rem`,color:R?"primary600":"neutral600"})});return(0,t.jsx)(x,{paddingBottom:ee,paddingLeft:Q,paddingRight:Q,paddingTop:ee,background:le,expanded:R,size:B,justifyContent:"space-between",cursor:W?"not-allowed":"",children:(0,t.jsxs)(s.k,{gap:3,flex:1,maxWidth:"100%",children:[h==="left"&&se,(0,t.jsx)(n,{onClick:ne,"aria-disabled":W,"aria-expanded":R,"aria-controls":Y,"aria-labelledby":H,"data-strapi-accordion-toggle":!0,expanded:R,type:"button",flex:1,minWidth:0,...N,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.y,{...J,children:l}),c&&(0,t.jsx)(T.Z,{as:"p",id:ie,textColor:de,children:c})]})}),h==="right"&&(0,t.jsxs)(s.k,{gap:3,children:[se,k]}),h==="left"&&k]})})}}}]);
