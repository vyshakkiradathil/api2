"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2812],{19150:function(U,p,t){t.d(p,{R:function(){return L}});var e=t(69262),s=t(33348),y=t(20108);function L(v={},D={}){const{id:c="",...A}=v,T=(0,s.stringify)(A,{encode:!1}),{get:f}=(0,e.kY)(),{data:E,isError:P,isLoading:R,refetch:O}=(0,y.useQuery)(["users",c,A],async()=>{const{data:{data:b}}=await f(`/admin/users/${c}${T?`?${T}`:""}`);return b},D);let C=[];return c&&E?C=[E]:Array.isArray(E?.results)&&(C=E.results),{users:C,pagination:E?.pagination??null,isLoading:R,isError:P,refetch:O}}},83196:function(U,p,t){var e=t(32735),s=t(72850),y=t(41415),L=t(69262),v=t(5644),D=t(60216),c=t.n(D),A=t(67879);const T=({displayedFilters:f})=>{const[E,P]=(0,e.useState)(!1),{formatMessage:R}=(0,A.Z)(),O=(0,e.useRef)(),C=()=>{P(b=>!b)};return e.createElement(e.Fragment,null,e.createElement(s.x,{paddingTop:1,paddingBottom:1},e.createElement(y.z,{variant:"tertiary",ref:O,startIcon:e.createElement(v.Z,null),onClick:C,size:"S"},R({id:"app.utils.filters",defaultMessage:"Filters"})),E&&e.createElement(L.J5,{displayedFilters:f,isVisible:E,onToggle:C,source:O})),e.createElement(L.W$,{filtersSchema:f}))};T.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired},p.Z=T},71765:function(U,p,t){t.r(p),t.d(p,{default:function(){return Le}});var e=t(32735),s=t(69262),y=t(83983),L=t(96709),v=t(17e3),D=t(72850),c=t(27649),A=t(82055),T=t(99223),f=t(67879),E=t(83196),P=t(20108),R=t(53038),O=t(19150),b=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,s.kY)(),{search:r}=(0,R.TH)(),m=(0,s.lm)(),o={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:M=>m({type:"warning",message:M.message})},{users:l,isError:i,isLoading:g}=(0,O.R)({},{...o,enabled:d,staleTime:2*(1e3*60)}),{data:h,isLoading:S,isError:x}=(0,P.useQuery)(["auditLogs",r],async({queryKey:M})=>{const ve=M[1],{data:Me}=await u(`/admin/audit-logs${ve}`);return Me},{...o,enabled:a});return{auditLogs:h,users:l,isLoading:g||S,hasError:x||i}},G=t(85025),X=t(55225),w=t(31600),k=t(26858),q=t(51654),_=t(60216),n=t.n(_),ee=t(96315),K=()=>{const{formatDate:a}=(0,f.Z)();return u=>{const r=(0,ee.Z)(u),m=a(r,{dateStyle:"long"}),o=a(r,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${o}`}},I=t(87933),te=t(23866),B=t(49372),ae=t(15335),se=t(64710);const N={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},Z=a=>N[a]||a,H=({actionLabel:a,actionName:d})=>e.createElement(I.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(B.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(B.Z,{textColor:"neutral600"},d));H.propTypes={actionLabel:n().string.isRequired,actionName:n().string.isRequired};var F=H;const $=({status:a,data:d,formattedDate:u})=>{const{formatMessage:r}=(0,f.Z)();if(a==="loading")return e.createElement(I.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(te.a,null,"Loading content..."));const{action:m,user:o,payload:l}=d;return e.createElement(e.Fragment,null,e.createElement(D.x,{marginBottom:3},e.createElement(B.Z,{variant:"delta",id:"title"},r({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ae.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:r({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:Z(m)},{model:l?.model})}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:o?.displayName||"-"}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:o?.id.toString()||"-"})),e.createElement(se.V,{value:JSON.stringify(l,null,2),disabled:!0,label:r({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};$.defaultProps={data:{}},$.propTypes={status:n().oneOf(["idle","loading","error","success"]).isRequired,data:n().shape({action:n().string,date:n().string,payload:n().object,user:n().object}),formattedDate:n().string.isRequired};var ne=$;const Q=({handleClose:a,logId:d})=>{const{get:u}=(0,s.kY)(),r=(0,s.lm)(),m=async h=>{const{data:S}=await u(`/admin/audit-logs/${h}`);if(!S)throw new Error("Audit log not found");return S},{data:o,status:l}=(0,P.useQuery)(["audit-log",d],()=>m(d),{onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),i=K(),g=o?i(o.date):"";return e.createElement(G.P,{onClose:a,labelledBy:"title"},e.createElement(X.x,null,e.createElement(k.O,{label:g,id:"title"},e.createElement(q.$,{isCurrent:!0},g))),e.createElement(w.f,null,e.createElement(ne,{status:l,data:o,formattedDate:g})))};Q.propTypes={handleClose:n().func.isRequired,logId:n().string.isRequired};var oe=Q;const W=({pagination:a})=>e.createElement(D.x,{paddingTop:4},e.createElement(I.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.v4,null),e.createElement(s.tU,{pagination:a})));W.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},W.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};var ie=W,re=t(35658),le=t(94547),Y=t(19786),de=t(50563),me=t(54894);const j=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:r}=(0,f.Z)(),m=K(),o=({type:l,value:i,model:g})=>l==="date"?m(i):l==="action"?r({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:Z(i)},{model:g}):i||"-";return e.createElement(re.p,null,d.map(l=>e.createElement(le.Tr,{key:l.id,...(0,s.X7)({fn:()=>u(l.id)})},a.map(({key:i,name:g,cellFormatter:h})=>e.createElement(Y.Td,{key:i},e.createElement(B.Z,{textColor:"neutral800"},o({type:i,value:h?h(l[g]):l[g],model:l.payload?.model})))),e.createElement(Y.Td,{...s.UW},e.createElement(I.k,{justifyContent:"end"},e.createElement(de.h,{onClick:()=>u(l.id),"aria-label":r({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${l.action} action`}),noBorder:!0,icon:e.createElement(me.Z,null)}))))))};j.defaultProps={rows:[]},j.propTypes={headers:n().array.isRequired,rows:n().array,onOpenModal:n().func.isRequired};var ue=j,ce=t(21428),ge=t(90333);const V=({value:a,options:d,onChange:u})=>{const{formatMessage:r}=(0,f.Z)(),m=r({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(ce.hQ,{"aria-label":m,value:a,onChange:u},d.map(({label:o,customValue:l})=>e.createElement(ge.O,{key:l,value:l},o)))};V.defaultProps={value:null},V.propTypes={value:n().string,options:n().arrayOf(n().shape({label:n().string.isRequired,customValue:n().string.isRequired}).isRequired).isRequired,onChange:n().func.isRequired};var z=V;const J=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}];var pe=({formatMessage:a,users:d,canReadUsers:u})=>{const r=Object.keys(N).map(o=>({label:a({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:Z(o)},{model:void 0}),customValue:o})),m=[{name:"action",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:r,customInput:z},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const o=i=>i.username?i.username:i.firstname&&i.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:i.firstname,lastname:i.lastname}):i.email,l=d.map(i=>({label:o(i),customValue:i.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:l,customInput:z},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},fe=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}];const Ee={...y.Z.settings.auditLogs,readUsers:y.Z.settings.users.read};var ye=()=>{const{formatMessage:a}=(0,f.Z)(),{allowedActions:{canRead:d,canReadUsers:u}}=(0,s.ss)(Ee),[{query:r},m]=(0,s.Kx)(),{auditLogs:o,users:l,isLoading:i,hasError:g}=b({canReadAuditLogs:d,canReadUsers:u});(0,s.go)();const h=pe({formatMessage:a,users:l,canReadUsers:u}),S=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),x=fe.map(M=>({...M,metadatas:{...M.metadatas,label:a(M.metadatas.label)}}));return g?e.createElement(L.A,null,e.createElement(v.D,null,e.createElement(D.x,{paddingTop:8},e.createElement(s.Hn,null)))):e.createElement(c.o,{"aria-busy":i},e.createElement(s.SL,{name:S}),e.createElement(A.T,{title:S,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(T.Z,{startActions:e.createElement(E.Z,{displayedFilters:h})}),e.createElement(v.D,{canRead:d},e.createElement(s.tM,{contentType:"Audit logs",headers:x,rows:o?.results||[],withBulkActions:!0,isLoading:i},e.createElement(ue,{headers:x,rows:o?.results||[],onOpenModal:M=>m({id:M})})),e.createElement(ie,{pagination:o?.pagination})),r?.id&&e.createElement(oe,{handleClose:()=>m({id:null},"remove"),logId:r.id}))},Le=()=>e.createElement(s.O4,{permissions:y.Z.settings.auditLogs.main},e.createElement(ye,null))},90333:function(U,p,t){t.d(p,{O:function(){return s}});var e=t(21428);const s=e.Wx},99223:function(U,p,t){t.d(p,{Z:function(){return y}});var e=t(74512),s=t(87933);const y=({startActions:L,endActions:v})=>!L&&!v?null:(0,e.jsxs)(s.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(s.k,{gap:2,wrap:"wrap",children:L}),(0,e.jsx)(s.k,{gap:2,shrink:0,wrap:"wrap",children:v})]})}}]);
